# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

# See yaml syntax: https://learnxinyminutes.com/yaml/
# see pipeline concept: https://learn.microsoft.com/en-us/azure/devops/pipelines/get-started/key-pipelines-concepts?view=azure-devops

trigger:
- main

pool:
  vmImage: ubuntu-latest

name: $(BuildDefinitionName)_$(Year:yyyy).$(Month).$(DayOfMonth)$(Rev:.r)

# stages: https://learn.microsoft.com/en-us/azure/devops/pipelines/process/stages?view=azure-devops&tabs=yaml
stages:
- stage: DeployToDev
  displayName: Development Deployment
  jobs:
  - job:
    steps:
    - script: echo Deployed To Dev
    # Checkout repository https://learn.microsoft.com/en-us/azure/devops/pipelines/repos/multi-repo-checkout?view=azure-devops
    #                  & https://learn.microsoft.com/en-us/azure/devops/pipelines/yaml-schema/steps-checkout?view=azure-pipelines
    - checkout: self
      path: mySource  # in absense of this line, the source is put in $(Agent.BuildDirectory)/s/ directory
    - script: echo Hello, world!
      displayName: 'Run a one-line script'

    - script: |
        echo Add other tasks to build, test, and deploy your project.
        echo See https://aka.ms/yaml
        echo 'Variable myPassword=$(myPassword)'
        echo 'Execution pipeline (version) name=$(name)'
        ls
        pwd
        echo 'Agent.BuildDirectory=$(Agent.BuildDirectory)'
        cat ./test.sql
        cat '$(Agent.BuildDirectory)/mySource/test.sql'
      displayName: 'Run a multi-line script'


- stage: DeployToTest
  displayName: Test Deployment
  jobs:
  - job:
    steps:
    - script: echo Deployed To Test

- stage: DeployToProd
  displayName: Production Deployment
  trigger: manual
  jobs:
  - job:
    steps:
    - script: echo Deployed To Prod